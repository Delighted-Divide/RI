<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reverend Insanity Reader & Scraper UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .novel-text {
            font-family: 'Crimson Pro', serif;
            line-height: 1.8;
            font-size: 1.25rem;
        }
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input[type=range] {
            height: 6px;
            -webkit-appearance: none;
            width: 100%;
            background: #334155;
            border-radius: 8px;
        }
        input[type=range]::-webkit-slider-thumb {
            width: 18px;
            -webkit-appearance: none;
            height: 18px;
            cursor: pointer;
            background: #38bdf8;
            border-radius: 50%;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-sky-400 mb-2 font-crimson">Reverend Insanity</h1>
            <p class="text-slate-400 italic">"The heart of a demon never has regret even in death"</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Controls Panel -->
            <aside class="space-y-6">
                <div class="glass rounded-2xl p-6 shadow-xl">
                    <h2 class="text-xl font-semibold mb-4 text-sky-300">Selection Controls</h2>
                    
                    <!-- Single Chapter Select -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-slate-400 mb-2">Single Chapter Control</label>
                        <div class="flex gap-2 mb-2">
                            <input type="text" id="single-chap-input" value="1" 
                                class="bg-slate-800 border-slate-700 rounded-lg px-3 py-2 w-full focus:ring-2 focus:ring-sky-500 outline-none text-center font-bold text-lg">
                            <button onclick="loadChapter()" class="bg-sky-600 hover:bg-sky-500 transition-colors px-6 py-2 rounded-lg font-medium">View</button>
                        </div>
                        <button onclick="copyAndNext()" class="w-full bg-indigo-600 hover:bg-indigo-500 transition-colors py-4 rounded-xl font-bold flex items-center justify-center gap-3 shadow-lg transform active:scale-95 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            COPY & NEXT CHAPTER
                        </button>
                    </div>

                    <div class="border-t border-slate-700 my-6"></div>

                    <!-- Range Selector -->
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-slate-400">Chapter Range</label>
                        
                        <div class="flex items-center justify-between text-xs text-slate-500">
                            <span id="range-start-label">Start: 1</span>
                            <span id="range-end-label">End: 5</span>
                        </div>

                        <div class="space-y-6">
                            <input type="range" id="start-slider" min="1" max="2334" value="1" class="w-full">
                            <input type="range" id="end-slider" min="1" max="2334" value="5" class="w-full">
                        </div>

                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="text-[10px] uppercase text-slate-500">Manual Start</label>
                                <input type="number" id="start-input" value="1" min="1" max="2334"
                                    class="bg-slate-800 border-slate-700 border rounded-lg px-2 py-1 w-full text-sm">
                            </div>
                            <div>
                                <label class="text-[10px] uppercase text-slate-500">Manual End</label>
                                <input type="number" id="end-input" value="5" min="1" max="2334"
                                    class="bg-slate-800 border-slate-700 border rounded-lg px-2 py-1 w-full text-sm">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-2 pt-4">
                            <button onclick="loadRange()" class="w-full bg-slate-700 hover:bg-slate-600 transition-colors py-2 rounded-lg text-sm font-medium">Load Range</button>
                            <button onclick="downloadRange()" class="w-full bg-emerald-700 hover:bg-emerald-600 transition-colors py-2 rounded-lg text-sm font-medium">Download TXT</button>
                        </div>
                    </div>
                </div>

                <!-- Stats Panel -->
                <div class="glass rounded-2xl p-6 shadow-xl">
                    <h2 class="text-xl font-semibold mb-4 text-emerald-300">Statistics</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Words</span>
                            <span id="stat-words" class="font-mono text-emerald-400">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Lines</span>
                            <span id="stat-lines" class="font-mono text-emerald-400">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Tokens</span>
                            <span id="stat-tokens" class="font-mono text-emerald-400">0</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="lg:col-span-2 space-y-6">
                <div class="glass rounded-2xl p-8 shadow-2xl relative min-h-[600px]">
                    <div id="content-header" class="flex justify-between items-start mb-6 border-b border-slate-700 pb-4">
                        <h2 id="display-title" class="text-3xl font-bold text-white">Select a Chapter</h2>
                        <button onclick="copyContent()" class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded-lg text-xs transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            Copy to Clipboard
                        </button>
                    </div>
                    
                    <div id="display-content" class="novel-text text-slate-300 whitespace-pre-wrap">
                        Chapter content will appear here...
                    </div>

                    <div id="loading-overlay" class="hidden absolute inset-0 bg-slate-900/80 items-center justify-center rounded-2xl flex">
                        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sky-400"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const startSlider = document.getElementById('start-slider');
        const endSlider = document.getElementById('end-slider');
        const startInput = document.getElementById('start-input');
        const endInput = document.getElementById('end-input');
        const startLabel = document.getElementById('range-start-label');
        const endLabel = document.getElementById('range-end-label');

        let manifest = {};

        // Load metadata on startup
        async function init() {
            try {
                const res = await fetch('manifest.json');
                manifest = await res.json();
                console.log("Manifest loaded");
            } catch (e) {
                console.error("Failed to load manifest", e);
            }
        }
        init();

        // Sync inputs and sliders
        function syncInputs(val, target) {
            target.value = val;
            updateLabels();
        }

        startSlider.oninput = (e) => syncInputs(e.target.value, startInput);
        endSlider.oninput = (e) => syncInputs(e.target.value, endInput);
        startInput.oninput = (e) => syncInputs(e.target.value, startSlider);
        endInput.oninput = (e) => syncInputs(e.target.value, endSlider);

        function updateLabels() {
            startLabel.innerText = `Start: ${startInput.value}`;
            endLabel.innerText = `End: ${endInput.value}`;
        }

        async function fetchChapterText(num) {
            const filename = `chapter_${String(num).padStart(4, '0')}.txt`;
            const res = await fetch(`chapters/${filename}`);
            if (!res.ok) throw new Error(`Chapter ${num} not found`);
            return await res.text();
        }

        async function loadChapter() {
            const num = parseInt(document.getElementById('single-chap-input').value);
            toggleLoading(true);
            try {
                const content = await fetchChapterText(num);
                const stats = manifest[num] || { words: 0, lines: 0, tokens: 0, title: `Chapter ${num}` };
                
                updateUI(stats.title, content, {
                    word_count: stats.words,
                    line_count: stats.lines,
                    token_count: stats.tokens
                });
            } catch (e) {
                alert(e.message);
            }
            toggleLoading(false);
        }

        async function copyAndNext() {
            const input = document.getElementById('single-chap-input');
            let num = parseInt(input.value);
            
            toggleLoading(true);
            try {
                const content = await fetchChapterText(num);
                const stats = manifest[num] || { words: 0, lines: 0, tokens: 0, title: `Chapter ${num}` };
                
                updateUI(stats.title, content, {
                    word_count: stats.words,
                    line_count: stats.lines,
                    token_count: stats.tokens
                });
                
                await navigator.clipboard.writeText(content);
                input.value = num + 1;
            } catch (e) {
                console.error(e.message);
            }
            toggleLoading(false);
        }

        async function loadRange() {
            const start = parseInt(startInput.value);
            const end = parseInt(endInput.value);
            toggleLoading(true);
            
            try {
                let combined = "";
                let t_words = 0, t_lines = 0, t_tokens = 0;
                
                for (let i = start; i <= end; i++) {
                    const content = await fetchChapterText(i);
                    const stats = manifest[i] || { words: 0, lines: 0, tokens: 0 };
                    
                    combined += (combined ? "\n\n------------------------------\n\n" : "") + content;
                    t_words += stats.words;
                    t_lines += stats.lines;
                    t_tokens += stats.tokens;
                }
                
                updateUI(`Chapters ${start} - ${end}`, combined, {
                    word_count: t_words,
                    line_count: t_lines,
                    token_count: t_tokens
                });
            } catch (e) {
                alert(e.message);
            }
            toggleLoading(false);
        }

        function downloadRange() {
            const start = startInput.value;
            const end = endInput.value;
            const content = document.getElementById('display-content').innerText;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reverend_insanity_${start}_${end}.txt`;
            document.body.appendChild(a);
            a.click();
            a.remove();
        }

        function updateUI(title, content, stats) {
            document.getElementById('display-title').innerText = title;
            document.getElementById('display-content').innerText = content;
            document.getElementById('stat-words').innerText = stats.word_count.toLocaleString();
            document.getElementById('stat-lines').innerText = stats.line_count.toLocaleString();
            document.getElementById('stat-tokens').innerText = stats.token_count.toLocaleString();
        }

        function copyContent() {
            const content = document.getElementById('display-content').innerText;
            navigator.clipboard.writeText(content);
        }

        function toggleLoading(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
        }

        updateLabels();
    </script>
</body>
</html>
